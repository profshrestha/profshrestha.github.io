<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EE 345 Flashcards</title>
  <!-- MathJax config FIRST -->
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [["$", "$"], ["\\(", "\\)"]],
        displayMath: [["$$", "$$"], ["\\[", "\\]"]]
      },
      svg: { fontCache: 'global' }
    };
  </script>
  <!-- Then load MathJax -->
  <script id="MathJax-script" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 20px;
    }
    .container { max-width: 900px; width: 100%; background: #fff; border-radius: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); overflow: hidden; }
    .header { background: linear-gradient(135deg, #4f46e5, #7c3aed); color: #fff; padding: 30px; text-align: center; }
    .header h1 { font-size: 2.2rem; font-weight: 700; margin-bottom: 8px; }
    .header p { opacity: 0.9; }
    .controls { display: flex; justify-content: space-between; align-items: center; padding: 20px 30px; background: #f8fafc; border-bottom: 1px solid #e2e8f0; gap: 12px; }
    .progress { display: flex; align-items: center; gap: 15px; }
    .progress-bar { width: 220px; height: 8px; background: #e2e8f0; border-radius: 4px; overflow: hidden; }
    .progress-fill { height: 100%; background: linear-gradient(90deg, #4f46e5, #7c3aed); transition: width 0.3s ease; border-radius: 4px; }
    .card-counter { font-weight: 600; color: #4f46e5; }
    .navigation { display: flex; gap: 10px; }
    .nav-btn { padding: 10px 18px; border: none; border-radius: 10px; background: #4f46e5; color: #fff; cursor: pointer; font-weight: 600; transition: all 0.2s ease; }
    .nav-btn:hover { background: #3730a3; transform: translateY(-1px); }
    .nav-btn:disabled { background: #94a3b8; cursor: not-allowed; transform: none; }
    .shuffle-btn { background: #059669; }
    .shuffle-btn:hover { background: #047857; }
    .flashcard { perspective: 1000px; margin: 30px; height: 420px; position: relative; }
    .card { position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.8s; transform-style: preserve-3d; cursor: pointer; }
    .card.flipped { transform: rotateY(180deg); }
    .card-face { position: absolute; inset: 0; backface-visibility: hidden; border-radius: 15px; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 28px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
    .card-front { background: linear-gradient(135deg, #f8fafc, #e2e8f0); border: 2px solid #cbd5e1; }
    .card-back { background: linear-gradient(135deg, #ecfdf5, #d1fae5); border: 2px solid #10b981; transform: rotateY(180deg); }
    .card-category { background: #4f46e5; color: #fff; padding: 8px 16px; border-radius: 20px; font-size: 0.9rem; font-weight: 700; margin-bottom: 16px; }
    .card-question { font-size: 1.3rem; font-weight: 700; color: #1e293b; margin-bottom: 14px; line-height: 1.4; }
    .card-formula { font-size: 1.3rem; margin: 10px 0 8px; padding: 12px 14px; background: #fff; border-radius: 10px; border-left: 4px solid #4f46e5; min-height: 48px; display: flex; align-items: center; justify-content: center; width: 100%; }
    .card-answer { font-size: 1.05rem; color: #065f46; line-height: 1.6; text-align: left; max-width: 680px; }
    .card-example { background: #f0f9ff; border: 1px solid #bae6fd; border-radius: 8px; padding: 12px; margin: 12px 0; font-size: 1rem; }
    .flip-hint { position: absolute; bottom: 14px; left: 50%; transform: translateX(-50%); color: #64748b; font-size: 0.9rem; animation: pulse 2s infinite; }
    @keyframes pulse { 0%,100%{opacity:.6} 50%{opacity:1} }
    .stats { display: flex; justify-content: space-around; padding: 18px; background: #f1f5f9; font-weight: 700; }
    .stat-item { text-align: center; }
    .stat-value { font-size: 1.6rem; color: #4f46e5; display: block; }
    .stat-label { color: #64748b; font-size: 0.9rem; font-weight: 600; }
    @media (max-width: 768px) {
      .container { margin: 10px; border-radius: 16px; }
      .header h1 { font-size: 1.8rem; }
      .controls { flex-direction: column; align-items: stretch; }
      .flashcard { margin: 18px; height: 360px; }
      .card-question { font-size: 1.15rem; }
      .card-formula { font-size: 1.15rem; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>EE 345 Flashcards</h1>
      <p>CH01</p>
    </div>

    <div class="controls">
      <div class="progress">
        <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
        <span class="card-counter" id="cardCounter">1 / 1</span>
      </div>
      <div class="navigation" role="group" aria-label="Navigation">
        <button class="nav-btn" id="prevBtn" onclick="previousCard()" aria-label="Previous card">‚Üê Previous</button>
        <button class="nav-btn" id="nextBtn" onclick="nextCard()" aria-label="Next card">Next ‚Üí</button>
        <button class="nav-btn shuffle-btn" onclick="shuffleCards()" aria-label="Shuffle cards">üîÄ Shuffle</button>
      </div>
    </div>

    <div class="flashcard">
      <div class="card" id="flashcard" onclick="flipCard()" aria-live="polite">
        <div class="card-face card-front" id="cardFront">
          <div class="card-category" id="category"></div>
          <div class="card-question" id="question"></div>
          <div class="card-formula" id="formula"></div>
          <div class="flip-hint">Click / Tap to reveal answer</div>
        </div>
        <div class="card-face card-back" id="cardBack">
          <div class="card-answer" id="answer"></div>
        </div>
      </div>
    </div>

    <div class="stats">
      <div class="stat-item">
        <span class="stat-value" id="cardsStudied">0</span>
        <span class="stat-label">Cards Studied</span>
      </div>
      <div class="stat-item">
        <span class="stat-value" id="currentStreak">0</span>
        <span class="stat-label">Current Streak</span>
      </div>
      <div class="stat-item">
        <span class="stat-value" id="totalCards">0</span>
        <span class="stat-label">Total Cards</span>
      </div>
    </div>
  </div>

  <script>
    // Single, clean flashcards array
    const flashcards = [
      {
        category: "Central Tendency",
        question: "When should you use median instead of mean?",
        formula: "",
        answer:
          "<strong>Use median when:</strong><br>‚Ä¢ Outliers are present<br>‚Ä¢ Data is skewed<br>‚Ä¢ You need robust central measure<br><div class='card-example'><strong>EE Example:</strong> Packet latencies where 95% are under 50ms but 5% exceed 500ms ‚Üí Use median because extreme values do not affect it</div>"
      },
      {
        category: "Central Tendency",
        question: "What is the formula for sample mean?",
        formula: "$\\bar{x} = \\dfrac{\\sum x_i}{n} = \\dfrac{x_1 + x_2 + \\cdots + x_n}{n}$",
        answer:
          "<strong>Sample Mean Formula:</strong><br>‚Ä¢ Sum all values and divide by sample size<br>‚Ä¢ Sensitive to outliers<br>‚Ä¢ Most common measure of central tendency<br><div class='card-example'><strong>Example:</strong> Voltages: 3.1, 3.3, 3.2 V<br>Mean = (3.1 + 3.3 + 3.2)/3 = 3.2 V</div>"
      },
      {
        category: "Weighted Means",
        question: "How do you combine means from groups with different sample sizes?",
        formula: "$\\bar{x}_{\\text{combined}} = \\dfrac{n_1\\bar{x}_1 + n_2\\bar{x}_2}{n_1 + n_2}$",
        answer:
          "<strong>Combined Mean:</strong><br>‚Ä¢ Weight each mean by its sample size<br>‚Ä¢ NOT the simple average of means<br>‚Ä¢ Larger groups have more influence<br><div class='card-example'><strong>EE Example:</strong> Lot A: n=25, mean=1.02kŒ©<br>Lot B: n=15, mean=0.98kŒ©<br>Combined = (25√ó1.02 + 15√ó0.98)/40 = 1.005kŒ©</div>"
      },
      {
        category: "Variability",
        question: "What is the sample variance formula?",
        formula: "$s^2 = \\dfrac{\\sum(x_i - \\bar{x})^2}{n-1}$",
        answer:
          "<strong>Sample Variance:</strong><br>‚Ä¢ Measures spread around the mean<br>‚Ä¢ Uses n-1 for degrees of freedom<br>‚Ä¢ Units are squared<br>‚Ä¢ Standard deviation is ‚àövariance<br><div class='card-example'><strong>EE Example:</strong> ADC readings vary by ¬±2 counts<br>s¬≤ = 4 counts¬≤, s = 2 counts</div>"
      },
      {
        category: "Variability",
        question: "How does standard deviation change with linear transformations?",
        formula: "Add c: New SD = s<br>Multiply by k: New SD = |k|s",
        answer:
          "<strong>Linear Transformation Rules:</strong><br>‚Ä¢ Adding constant: SD unchanged<br>‚Ä¢ Multiplying by constant: SD scales by |k|<br>‚Ä¢ Mean changes for both operations<br><div class='card-example'><strong>EE Example:</strong> Current in mA has SD = 0.1 mA<br>Convert to ŒºA (√ó1000): New SD = 100 ŒºA</div>"
      },
      {
        category: "Quartiles",
        question: "What is the IQR and how is it calculated?",
        formula: "$IQR = Q_3 - Q_1$",
        answer:
          "<strong>Interquartile Range:</strong><br>‚Ä¢ Range of middle 50% of data<br>‚Ä¢ Q‚ÇÅ = 25th percentile, Q‚ÇÉ = 75th percentile<br>‚Ä¢ Robust measure of spread<br>‚Ä¢ Not affected by outliers<br><div class='card-example'><strong>EE Example:</strong> Leakage currents: Q‚ÇÅ = 2.4 nA, Q‚ÇÉ = 3.1 nA<br>IQR = 3.1 ‚àí 2.4 = 0.7 nA</div>"
      },
      {
        category: "Outlier Detection",
        question: "What is the 1.5√óIQR rule for outliers?",
        formula: "Outliers: < $Q_1 - 1.5 \\times IQR$ or > $Q_3 + 1.5 \\times IQR$",
        answer:
          "<strong>1.5√óIQR Outlier Rule:</strong><br>‚Ä¢ Values beyond Q‚ÇÅ ‚àí 1.5√óIQR (lower fence)<br>‚Ä¢ Values beyond Q‚ÇÉ + 1.5√óIQR (upper fence)<br>‚Ä¢ More robust than mean ¬± 2SD<br><div class='card-example'><strong>EE Example:</strong> Q‚ÇÅ = 2.4 nA, Q‚ÇÉ = 3.1 nA, IQR = 0.7 nA<br>Upper fence = 3.1 + 1.5(0.7) = 4.15 nA<br>15.8 nA is an outlier!</div>"
      },
      {
        category: "Association",
        question: "What are the main types of association in scatterplots?",
        formula: "",
        answer:
          "<strong>Types of Association:</strong><br>‚Ä¢ <strong>Positive Linear:</strong> As x increases, y increases linearly<br>‚Ä¢ <strong>Negative Linear:</strong> As x increases, y decreases linearly<br>‚Ä¢ <strong>Nonlinear:</strong> Curved relationship<br>‚Ä¢ <strong>No Association:</strong> Random scatter<br><div class='card-example'><strong>EE Example:</strong> V vs I for a resistor shows positive linear (Ohm's law). Outliers may indicate heating or damage.</div>"
      },
      {
        category: "Formulas",
        question: "What is the weighted mean formula?",
        formula: "$\\bar{x}_w = \\dfrac{w_1x_1 + w_2x_2 + \\cdots + w_kx_k}{w_1 + w_2 + \\cdots + w_k}$",
        answer:
          "<strong>Weighted Mean:</strong><br>‚Ä¢ Each value multiplied by its weight<br>‚Ä¢ Divide by sum of weights<br>‚Ä¢ Used when values have different importance<br><div class='card-example'><strong>EE Example:</strong> Component costs weighted by quantity:<br>100 resistors @ $0.05, 50 caps @ $0.10<br>Weighted mean = (100√ó0.05 + 50√ó0.10)/150</div>"
      },
      {
        category: "EE Applications",
        question: "Power measurements: 12.1, 12.3, 12.0, 37.8, 12.2 mW. Which central measure is better?",
        formula: "",
        answer:
          "<strong>Median is better (12.2 mW)</strong><br>‚Ä¢ Mean = 17.3 mW (inflated by outlier)<br>‚Ä¢ 37.8 mW is likely a defective unit<br>‚Ä¢ Median represents typical performance<br>‚Ä¢ Always check for outliers first!<br><div class='card-example'><strong>Rule:</strong> Outliers present ‚Üí use median; no outliers ‚Üí mean is fine</div>"
      },
      {
        category: "EE Applications",
        question: "ADC readings: 2045, 2048, 2051, 2047, 2049, 2044 counts. Find the standard deviation.",
        formula: "",
        answer:
          "<strong>Solution:</strong><br>1. Mean = 2047.33 counts<br>2. Deviations squared: (‚àí2.33)¬≤, (0.67)¬≤, (3.67)¬≤, (‚àí0.33)¬≤, (1.67)¬≤, (‚àí3.33)¬≤<br>3. s¬≤ = 33.34/5 = 6.67 counts¬≤<br>4. s = ‚àö6.67 = 2.58 counts<br><div class='card-example'><strong>Conversion:</strong> If 1 count = 0.61 mV ‚Üí SD in voltage = 2.58 √ó 0.61 = 1.57 mV</div>"
      },
      {
        category: "Common Pitfalls",
        question: "Why cannot you just average group means when combining data?",
        formula: "",
        answer:
          "<strong>Because sample sizes matter!</strong><br>‚Ä¢ Simple average ignores group sizes<br>‚Ä¢ Larger groups should have more influence<br>‚Ä¢ Must weight by sample size<br><div class='card-example'><strong>Example:</strong> Group A: n=100, mean=5 V; Group B: n=10, mean=7 V<br>Simple average: (5+7)/2 = 6 V ‚ùå<br>Correct: (100√ó5 + 10√ó7)/110 = 5.18 V ‚úÖ</div>"
      },
      {
        category: "Common Pitfalls",
        question: "A student uses mean ¬± 2SD to find outliers. What is wrong?",
        formula: "",
        answer:
          "<strong>Problems with mean ¬± 2SD:</strong><br>‚Ä¢ Assumes normal distribution<br>‚Ä¢ Mean and SD affected by outliers<br>‚Ä¢ Creates circular logic<br>‚Ä¢ 1.5√óIQR rule is more robust<br><div class='card-example'><strong>Better approach:</strong> Use quartiles and IQR (not affected by outliers; works for any distribution shape)</div>"
      },
      {
        category: "Unit Conversions",
        question: "Voltage measurements have SD = 0.05 V. Convert to millivolts ‚Äî what is the new SD?",
        formula: "",
        answer:
          "<strong>New SD = 50 mV</strong><br>‚Ä¢ Multiply by 1000 to convert V to mV<br>‚Ä¢ SD scales linearly: SD<sub>new</sub> = |k| √ó SD<sub>old</sub><br>‚Ä¢ Variance scales by k¬≤<br><div class='card-example'><strong>Linear transformation:</strong> Original SD = 0.05 V ‚Üí √ó1000 ‚Üí 50 mV</div>"
      },
      {
        category: "Quartiles Practice",
        question: "Data: 4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 4.7, 4.8 ns. Find Q‚ÇÅ and Q‚ÇÉ.",
        formula: "",
        answer:
          "<strong>Solution:</strong><br>‚Ä¢ n = 8 (even)<br>‚Ä¢ Q‚ÇÅ position = 2.25 ‚Üí between 2nd & 3rd values<br>‚Ä¢ Q‚ÇÅ = 4.2 + 0.25(4.3 ‚àí 4.2) = 4.225 ‚âà 4.25 ns<br>‚Ä¢ Q‚ÇÉ position = 6.75 ‚Üí between 6th & 7th values<br>‚Ä¢ Q‚ÇÉ = 4.6 + 0.75(4.7 ‚àí 4.6) = 4.675 ‚âà 4.65 ns<br><div class='card-example'><strong>IQR ‚âà 0.40 ns</strong></div>"
      },
      {
        category: "Resistance Example",
        question: "I‚ÄìV data shows linear trend except one point. What might cause the deviation?",
        formula: "",
        answer:
          "<strong>Possible causes of I‚ÄìV outliers:</strong><br>‚Ä¢ <strong>Component heating:</strong> R increases at high power<br>‚Ä¢ <strong>Measurement error:</strong> Bad connection, meter issue<br>‚Ä¢ <strong>Component damage:</strong> Exceeded ratings<br>‚Ä¢ <strong>Nonlinear effects:</strong> Not purely resistive<br><div class='card-example'><strong>EE Insight:</strong> Do not assume outliers are always errors ‚Äî they often reveal important physics.</div>"
      },
      {
        category: "Statistics Rules",
        question: "What does the Empirical Rule tell us?",
        formula: "68% within ¬±1SD, 95% within ¬±2SD, 99.7% within ¬±3SD",
        answer:
          "<strong>Empirical Rule (68‚Äì95‚Äì99.7):</strong><br>For bell-shaped distributions:<br>‚Ä¢ ~68% within ¬±1 SD<br>‚Ä¢ ~95% within ¬±2 SD<br>‚Ä¢ ~99.7% within ¬±3 SD<br><div class='card-example'><strong>EE Application:</strong> If resistor spec is 100Œ© ¬± 5% and SD = 2Œ©, then ~95% are within 96‚Äì104Œ©.</div>"
      },
      {
        category: "Sample Size",
        question: "Why do we use n‚àí1 in the sample variance formula?",
        formula: "",
        answer:
          "<strong>Degrees of Freedom:</strong><br>‚Ä¢ We lose 1 degree of freedom estimating the mean<br>‚Ä¢ n‚àí1 makes sample variance unbiased (Bessel's correction)<br>‚Ä¢ For large n, n‚àí1 ‚âà n<br><div class='card-example'><strong>Intuition:</strong> If you know n‚àí1 deviations and the mean, the last deviation is determined ‚Äî only n‚àí1 values are free to vary.</div>"
      },
      {
        category: "EE Tolerance",
        question: "A 47 kŒ© resistor measures 46.8 kŒ©. Is this within ¬±5% tolerance?",
        formula: "",
        answer:
          "<strong>Yes, within tolerance!</strong><br>‚Ä¢ 5% of 47 kŒ© = 2.35 kŒ©<br>‚Ä¢ Acceptable range: 44.65 kŒ© to 49.35 kŒ©<br>‚Ä¢ 46.8 kŒ© falls within this range<br><div class='card-example'><strong>Tolerance check:</strong> |46.8 ‚àí 47| = 0.2 kŒ© ‚Üí 0.43% &lt; 5% ‚úÖ</div>"
      },
      {
        category: "Measurement Systems",
        question: "You have 5 measurements with 1 obvious outlier. How do you report the central value?",
        formula: "",
        answer:
          "<strong>Report the median:</strong><br>‚Ä¢ Less sensitive to the outlier<br>‚Ä¢ More representative of typical value<br>‚Ä¢ Include a note about the outlier<br>‚Ä¢ Investigate the outlier's cause<br><div class='card-example'><strong>Report format:</strong> Median = 12.2 mW (n=5). Note: One outlier at 37.8 mW likely defective.</div>"
      },
      {
        category: "Quality Control",
        question: "Production line produces components with specs. How do you use IQR for quality control?",
        formula: "",
        answer:
          "<strong>IQR Quality Control:</strong><br>‚Ä¢ Monitor Q‚ÇÅ, median, Q‚ÇÉ over time<br>‚Ä¢ Flag batches with excessive IQR<br>‚Ä¢ Use 1.5√óIQR rule to identify defects<br>‚Ä¢ Track outlier percentage<br><div class='card-example'><strong>Alert:</strong> If outlier rate > 2% or IQR increases 50%, investigate the process.</div>"
      },
      {
        category: "Data Analysis",
        question: "Combining resistor bins with same SD but different means ‚Äî what happens to overall SD?",
        formula: "",
        answer:
          "<strong>Overall SD increases!</strong><br>‚Ä¢ Even though individual SDs are equal<br>‚Ä¢ Between-group variation adds to within-group variation<br>‚Ä¢ Combined data spans a wider range<br><div class='card-example'><strong>Example:</strong> 50Œ© bin (SD=2Œ©) + 100Œ© bin (SD=2Œ©) ‚Üí Combined SD ¬ª 2Œ© because values span 46‚Äì104Œ©</div>"
      },
      {
        category: "Formulas Review",
        question: "What is the difference between sample variance and population variance?",
        formula: "Sample: $s^2 = \\dfrac{\\sum(x_i - \\bar{x})^2}{n-1}$<br>Population: $\\sigma^2 = \\dfrac{\\sum(x_i - \\mu)^2}{N}$",
        answer:
          "<strong>Key differences:</strong><br>‚Ä¢ Sample uses n‚àí1, population uses N<br>‚Ä¢ Sample estimates; population is exact<br>‚Ä¢ Sample uses xÃÑ; population uses Œº<br>‚Ä¢ In EE, we almost always use sample formulas<br><div class='card-example'><strong>Remember:</strong> Real data = samples from a population ‚Äî use n‚àí1 for unbiased estimation.</div>"
      },
      {
        category: "Final Review",
        question: "Quick check: When do you use mean vs median, and what is the 1.5√óIQR rule?",
        formula: "",
        answer:
          "<strong>Mean vs Median:</strong><br>‚Ä¢ Mean: No outliers, symmetric data<br>‚Ä¢ Median: Outliers present, skewed data<br><br><strong>1.5√óIQR Rule:</strong><br>‚Ä¢ Lower fence: Q‚ÇÅ ‚àí 1.5√óIQR<br>‚Ä¢ Upper fence: Q‚ÇÉ + 1.5√óIQR<br>‚Ä¢ Values outside fences = outliers<br><div class='card-example'><strong>EE tip:</strong> Always plot your data first!</div>"
      },
      {
        category: "Master Review",
        question: "State the linear transformation rules for mean and standard deviation.",
        formula: "",
        answer:
          "<strong>Linear Transformation Rules:</strong><br><br><strong>Add constant c:</strong><br>‚Ä¢ New mean = xÃÑ + c<br>‚Ä¢ New SD = s (unchanged)<br><br><strong>Multiply by k:</strong><br>‚Ä¢ New mean = k¬∑xÃÑ<br>‚Ä¢ New SD = |k|¬∑s<br><div class='card-example'><strong>EE Example:</strong> Convert 5 V ¬± 0.1 V to mV ‚Üí 5000 mV ¬± 100 mV</div>"
      }
    ];

    let currentCardIndex = 0;
    let isFlipped = false;
    const cardsStudied = new Set();
    let currentStreak = 0;

    function typeset(targetEls) {
      if (window.MathJax && MathJax.typesetPromise) {
        MathJax.typesetPromise(targetEls).catch(() => {});
      }
    }

    function updateCountersOnly() {
      document.getElementById('cardsStudied').textContent = cardsStudied.size;
      document.getElementById('currentStreak').textContent = currentStreak;
    }

    function updateDisplay() {
      const card = flashcards[currentCardIndex];
      const categoryEl = document.getElementById('category');
      const questionEl = document.getElementById('question');
      const formulaEl = document.getElementById('formula');
      const answerEl = document.getElementById('answer');

      categoryEl.textContent = card.category;
      questionEl.textContent = card.question;
      formulaEl.innerHTML = card.formula || '';
      answerEl.innerHTML = card.answer || '';

      // Progress & counters
      const progress = ((currentCardIndex + 1) / flashcards.length) * 100;
      document.getElementById('progressFill').style.width = progress + '%';
      document.getElementById('cardCounter').textContent = `${currentCardIndex + 1} / ${flashcards.length}`;
      document.getElementById('totalCards').textContent = flashcards.length;
      updateCountersOnly();

      // Reset flip state when navigating
      const cardEl = document.getElementById('flashcard');
      cardEl.classList.remove('flipped');
      isFlipped = false;

      // Enable/disable nav
      document.getElementById('prevBtn').disabled = currentCardIndex === 0;
      document.getElementById('nextBtn').disabled = currentCardIndex === flashcards.length - 1;

      // Typeset MathJax in formula & answer regions
      typeset([formulaEl, answerEl]);
    }

    function flipCard() {
      const cardEl = document.getElementById('flashcard');
      cardEl.classList.toggle('flipped');
      isFlipped = !isFlipped;
      if (isFlipped && !cardsStudied.has(currentCardIndex)) {
        cardsStudied.add(currentCardIndex);
        currentStreak++;
        updateCountersOnly(); // Do NOT call updateDisplay() here (would unflip the card)
      }
    }

    function nextCard() {
      if (currentCardIndex < flashcards.length - 1) {
        currentCardIndex++;
        updateDisplay();
      }
    }

    function previousCard() {
      if (currentCardIndex > 0) {
        currentCardIndex--;
        updateDisplay();
      }
    }

    function shuffleCards() {
      for (let i = flashcards.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [flashcards[i], flashcards[j]] = [flashcards[j], flashcards[i]];
      }
      currentCardIndex = 0;
      currentStreak = 0;
      cardsStudied.clear();
      updateDisplay();
    }

    // Keyboard navigation
    document.addEventListener('keydown', function(event) {
      switch(event.key) {
        case ' ':
        case 'Enter':
          event.preventDefault();
          flipCard();
          break;
        case 'ArrowLeft':
          event.preventDefault();
          previousCard();
          break;
        case 'ArrowRight':
          event.preventDefault();
          nextCard();
          break;
        case 'r':
        case 'R':
          if (event.ctrlKey) {
            event.preventDefault();
            shuffleCards();
          }
          break;
      }
    });

    // Touch/swipe support for mobile
    let startX = 0, startY = 0;
    document.addEventListener('touchstart', (e) => {
      startX = e.touches[0].clientX;
      startY = e.touches[0].clientY;
    });
    document.addEventListener('touchend', (e) => {
      if (!startX && !startY) return;
      const endX = e.changedTouches[0].clientX;
      const endY = e.changedTouches[0].clientY;
      const diffX = startX - endX;
      const diffY = startY - endY;
      if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
        if (diffX > 0) nextCard(); else previousCard();
      }
      startX = 0; startY = 0;
    });

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
      updateDisplay();

      // Small helper showing shortcuts for a moment
      const shortcutsInfo = document.createElement('div');
      shortcutsInfo.innerHTML = `
        <div style="position: fixed; bottom: 10px; right: 10px; background: rgba(0,0,0,0.72); color: #fff; padding: 10px 12px; border-radius: 8px; font-size: 0.8rem; max-width: 220px;">
          <strong>Keyboard Shortcuts</strong><br>
          ‚Ä¢ Space/Enter: Flip<br>
          ‚Ä¢ ‚Üê / ‚Üí : Navigate<br>
          ‚Ä¢ Ctrl+R: Shuffle<br>
          ‚Ä¢ Swipe on mobile
        </div>`;
      document.body.appendChild(shortcutsInfo);
      setTimeout(() => {
        shortcutsInfo.style.opacity = '0';
        shortcutsInfo.style.transition = 'opacity 1s';
        setTimeout(() => shortcutsInfo.remove(), 1000);
      }, 5000);

      // If MathJax loads after initial paint, typeset again
      const mj = document.getElementById('MathJax-script');
      if (mj) mj.addEventListener('load', () => typeset([document.getElementById('formula'), document.getElementById('answer')]));
    });
  </script>
</body>
</html>
